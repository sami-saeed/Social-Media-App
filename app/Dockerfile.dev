# Match your version
FROM ruby:3.1.2-slim

# OS deps for Rails + sqlite + ActiveStorage variants + JS (importmap ok, jsbundling ok)
RUN apt-get update -qq && apt-get install -y --no-install-recommends \
  build-essential git curl pkg-config \
  libsqlite3-dev libvips \
  nodejs npm \
  && rm -rf /var/lib/apt/lists/*

# Bundler settings
ENV BUNDLE_PATH=/usr/local/bundle \
    BUNDLE_JOBS=4 \
    BUNDLE_RETRY=3

WORKDIR /app

# Install gems (cached layer)
COPY Gemfile Gemfile.lock ./
RUN bundle install

# (Compose will mount your code; copying is harmless)
COPY . .

EXPOSE 3000

# Compose will override the command; shell helps interactive use
CMD ["bash"]
